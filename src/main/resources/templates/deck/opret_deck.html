<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: headerElement">
    <meta charset="UTF-8">
    <title>Registrerer deck</title>
</head>
<body>

<div class="container-fluid page">
    <header th:replace="fragments/top_menu :: top_menuElement"></header>

    <section class="col-auto">
        <form th:action="@{/deck/opret_deck}" th:object="${deck}" method="post">

            <div class="col-sm">
                <h1>Registrerer nyt deck</h1>
            </div>

            <div class="form-group col-sm-8">
                <label>Commander</label>
                <input type="text" class="form-control" placeholder="Commander" required="required"
                       th:field="*{commanderName}">
                <span th:if="${#fields.hasErrors('commanderName')}" th:errors="*{commanderName}"></span>
            </div>

            <div class="form-group col-sm-8">
                <label>Partner Commander</label>
                <input type="text" class="form-control" placeholder="Partner Commander"
                       th:field="*{partnerCommanderName}">
                <span th:if="${#fields.hasErrors('partnerCommanderName')}" th:errors="*{partnerCommanderName}"></span>
            </div>

            <div class="form-group col-sm-8">
                <label>Navnet på decket</label>
                <input type="text" class="form-control" placeholder="Decknavn" th:field="*{nameOfDeck}">
                <span th:if="${#fields.hasErrors('nameOfDeck')}" th:errors="*{nameOfDeck}"></span>
            </div>

            <div class="form-group col-sm-8">
                <label>Decktype</label>
                <div>
                    <!-- https://www.baeldung.com/thymeleaf-enums -->
                    <div th:each="gameType: ${T(com.padc.demo.core.enums.GameType).values()}">
                        <!-- Need to have the th:value, because it could have an array of values -->
                        <input type="radio" th:field="*{gameType}" required th:value="${gameType}">
                        <label th:text="${gameType.getDisplayValue()}"></label>
                    </div>
                    <span th:if="${#fields.hasErrors('gameType')}" th:errors="*{gameType}"></span>
                </div>
            </div>

            <div class="form-group col-sm-8">
                <button type="submit" class="btn btn-primary">Gem</button>
            </div>

        </form>
    </section>
</div>
<footer th:replace="fragments/footer :: footerElement"></footer>
</body>

<script>

    // Venter til alt HTML og Javascript er loaded
    $(document).ready(function () {
        // autocomplete er en metode der laver en dropdown menu og har nogle forskellige parameter
        // source - JSON fil - kan være hvad som helst. her er function bagefter, fordi man ønsker at få
        // returneret et ajaxkald
        $('#commanderName, #partnerCommanderName').autocomplete(
            {
                source: function (request, response) {
                    console.dir(request);

                    // ajax laver selve connection og henter data fra externe API
                    $.ajax(
                        {
                            url: 'https://api.magicthegathering.io/v1/cards',
                            dataType: "json",
                            data:
                                {
                                    name: request.term,
                                    format: "Commander",
                                    supertypes: "Legendary",
                                    types: "Creature|Planeswalker",
                                    pageSize: 5,
                                    page: 1
                                },
                            // success - hvad skal der ske, hvis det gik godt
                            success: function (data) {
                                console.dir(data)

                                // laver et nyt tomt array
                                var commanderNameAPI = [];

                                // looper igennem alle kortene
                                data.cards.forEach(function (card) {

                                    // Søger efter om et specifikt navn allerede er tilføjet til arrayet
                                    // Hvis ja, så returneres dens index
                                    // Hvis nej, så returneres -1
                                    // Her ønskes der kun at tilføje unikke navne til arrayet
                                    if ($.inArray(card.name, commanderNameAPI) === -1) {
                                        // tager navnet fra hvert kort, og ligger i arrayet (samme som append)
                                        commanderNameAPI.push(card.name);
                                    }
                                });
                                console.dir(commanderNameAPI);

                                // returnere resultatet af arrayet tilbage til source (autocomplete)
                                response(commanderNameAPI);
                            }
                        });
                },
                minLength: 3
            });
    });

</script>
</html>